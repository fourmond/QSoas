#! /bin/sh

v=""
if [ "$1" ]; then
    v="VERSION=$1"
fi

if echo $2 | grep -i UNIVERSAL; then
    univ="UNIVERSAL=1";
fi

# How I hate all these slight differences that make things difficult
QMAKE=/opt/local/bin/qmake
if [ -r /usr/bin/qmake ]; then
    QMAKE=/usr/bin/qmake
fi

# Here, we try using ruby1.9 on mac if it is present ?
if [ -r /opt/local/bin/ruby1.9 ]; then
    extra="RUBY=/opt/local/bin/ruby1.9"
fi

$QMAKE $extra $v $univ

# For some reason, mac's Qt writes a wrong library name for linking
# when producing a debug stuff:
if [ -z "$NOTWEAK" ]; then
    perl -pi -e 's/_debug//g' Makefile
    # And now it picks the wrong 
    perl -pi.bak -e 's#/Developer## if(/CC|CXX|LINK/);' Makefile
fi
# cd odrpack; ./full-conversion d_lpkbls.c d_mprec.c d_odr.c