#! /bin/sh

v=""
if [ "$1" ]; then
    v="VERSION=$1"
fi

if echo $2 | grep -i UNIVERSAL; then
    univ="UNIVERSAL=1";
fi

# How I hate all these slight differences that make things difficult
if [ -z "$QMAKE" ]; then
    for f in /opt/local/libexec/qt5/bin/qmake /usr/lib/qt5/bin/qmake ; do
        if [ -x "$f" ]; then
            QMAKE="$f";
        fi
    done
fi

if [ -z "$QMAKE" ]; then
    QMAKE=qmake
fi

if [ "$MRUBY_DIR" ]; then
    extra="$extra MRUBY_DIR=$MRUBY_DIR"
fi
   

$QMAKE $extra $v $univ

# For some reason, mac's Qt writes a wrong library name for linking
# when producing a debug stuff:
if [ -z "$NOTWEAK" ]; then
    perl -pi -e 's/_debug//g' Makefile
    # And now it picks the wrong 
    perl -pi.bak -e 's#/Developer## if(/CC|CXX|LINK/);' Makefile
fi
# cd odrpack; ./full-conversion d_lpkbls.c d_mprec.c d_odr.c
