# Checks the parsing and use of formulas in parameters
generate-buffer 0 10

# Check that a simple polynomial is going to work
sim-polynomial /order=4 parameters/poly-4-1.params 0
apply-formula y-=1+2*x+3*x**2-2*x**3+0.2*x**4
assert '$stats["y_max"]-$stats["y_min"] < 1e-12'

# First test: simple interdependency
sim-polynomial /order=4 parameters/poly-4-2.params 0
apply-formula y-=2+2*x+3*x**2-2*x**3+0.1*x**4
assert '$stats["y_max"]-$stats["y_min"] < 2e-12'

# Second test: chain dependency (ascending)
sim-polynomial /order=4 parameters/poly-4-3.params 0
apply-formula y-=1+1*x+2*x**2-2*x**3+2*x**4
assert '$stats["y_max"]-$stats["y_min"] < 5e-12'

# Third test: chain dependency (descending)
sim-polynomial /order=4 parameters/poly-4-4.params 0
apply-formula y-=1+5*x+5*x**2-2*x**3+0.5*x**4
assert '$stats["y_max"]-$stats["y_min"] < 2e-12'

# Fourth test: long (linear) chain of dependencies
sim-polynomial /order=4 parameters/poly-4-5.params 0
apply-formula y-=1+10*x+6*x**2+3*x**3+1*x**4
assert '$stats["y_max"]-$stats["y_min"] < 2e-12'